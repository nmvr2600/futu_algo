# 缠论测试套件

本目录包含缠论技术分析的完整测试套件，用于验证缠论核心功能的正确性和稳定性。

## 测试文件说明

### 1. 核心功能测试

- **test_chanlun_core_features.py** - 缠论核心功能测试
  - 合并 K 线功能测试
  - 分型识别测试
  - 基础数据结构验证

### 2. 笔和线段测试

- **test_chanlun_strokes_segments.py** - 笔和线段构建测试
  - 笔的构建逻辑验证
  - 线段端点确定测试
  - 笔与线段关系验证

### 3. 中枢和索引映射测试

- **test_chanlun_central_mapping.py** - 中枢识别和索引映射测试
  - 中枢识别准确性测试
  - 索引映射一致性验证
  - 可视化兼容性测试

### 4. 综合测试

- **test_chanlun_comprehensive.py** - 完整缠论处理流程测试
  - 端到端处理流程验证
  - 复杂数据结构测试
  - 性能指标测试
  - 边界情况测试

### 5. 测试运行器

- **test_runner.py** - 统一测试运行器
  - 批量运行所有测试
  - 生成详细测试报告
  - 支持单个测试运行

## 使用方法

### 运行所有测试

```bash
cd tests
python test_runner.py
```

### 运行特定测试

```bash
cd tests
python test_runner.py test_chanlun_core_features.py
```

### 详细输出模式

```bash
cd tests
python test_runner.py -v
```

### 生成报告

```bash
cd tests
python test_runner.py -r
```

## 测试数据

测试使用多种模拟数据模式：

1. **复杂模式** - 包含趋势、震荡、回调的复杂走势
2. **趋势模式** - 明显的上升或下降趋势
3. **震荡模式** - 价格整理震荡走势
4. **边界模式** - 极端边界情况测试

## 测试覆盖范围

### 功能测试

- ✅ 合并 K 线功能
- ✅ 分型识别算法
- ✅ 笔构建逻辑
- ✅ 线段构建算法
- ✅ 中枢识别算法
- ✅ 索引映射机制

### 数据验证

- ✅ 索引范围检查
- ✅ 价格数据一致性
- ✅ 时间序列完整性
- ✅ 边界条件处理

### 性能测试

- ✅ 大数据集处理性能
- ✅ 内存使用效率
- ✅ 处理时间监控

### 兼容性测试

- ✅ 可视化数据格式
- ✅ 索引映射准确性
- ✅ 异常数据处理

## 测试报告

运行测试后会生成包含以下信息的详细报告：

- 每个测试文件的运行结果
- 测试耗时统计
- 错误信息和堆栈跟踪
- 总体通过率统计

## 扩展指南

### 添加新测试

1. 创建新的测试文件，命名格式：`test_*.py`
2. 继承测试模式，包含完整的测试类
3. 在 `test_runner.py` 的 `test_files` 列表中添加新文件
4. 确保测试文件可以独立运行

### 测试数据生成

使用 `create_comprehensive_test_data()` 方法生成标准测试数据，支持多种模式：

- complex: 复杂真实走势
- trend: 趋势走势
- consolidation: 震荡走势

### 错误处理

所有测试都包含完整的异常处理，确保测试失败时能提供详细的错误信息用于调试。

## 注意事项

1. 确保 `util.chanlun_legacy` 模块可用
2. 测试需要 pandas 和 numpy 依赖
3. 建议在虚拟环境中运行测试
4. 测试数据为模拟数据，不保证与实际市场数据完全一致
